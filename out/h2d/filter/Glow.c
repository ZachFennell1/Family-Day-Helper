// Generated by HLC 4.2.4 (HL v4)
#define HLC_BOOT
#include <hlc.h>
#include <h2d/filter/Glow.h>
#include <h3d/shader/ScreenShader.h>
#include <h3d/shader/Blur.h>
void h2d_filter_Blur_new(h2d__filter__Blur,double*,double*,double*,double*);
#include <h3d/Vector.h>
#include <h2d/RenderContext.h>
#include <h2d/Tile.h>
#include <h3d/mat/Texture.h>
#include <h3d/mat/Filter.h>
#include <h3d/impl/TextureCache.h>
#include <hxd/PixelFormat.h>
#include <h2d/BlendMode.h>
#include <h3d/mat/Pass.h>
extern String s$glowSave;
h3d__mat__Texture h3d_impl_TextureCache_allocTileTarget(h3d__impl__TextureCache,String,h2d__Tile,bool*,venum*);
extern venum* g$h2d_BlendMode_None;
void h3d_pass_Copy_run(h3d__mat__Texture,h3d__mat__Texture,venum*,h3d__mat__Pass,vdynamic*);
extern venum* g$h3d_mat_Filter_Linear;
venum* h3d_mat_Texture_set_filter(h3d__mat__Texture,venum*);
#include <h3d/impl/RenderContext.h>
void h3d_pass_Blur_apply(h3d__pass__Blur,h3d__impl__RenderContext,h3d__mat__Texture,h3d__mat__Texture);
extern venum* g$h2d_BlendMode_Erase;
extern venum* g$h2d_BlendMode_Alpha;

void h2d_filter_Glow_new(h2d__filter__Glow r0,int* r1,double* r2,double* r3,double* r4,double* r5,bool* r6) {
	h3d__shader__ScreenShader r18;
	bool r12, r17;
	h3d__shader__Blur r20;
	h3d__pass__Blur r19;
	double r8, r9, r10, r11, r14, r15, r16;
	int r7;
	if( r1 ) goto label$1de0c46_1_3;
	r7 = 16777215;
	goto label$1de0c46_1_4;
	label$1de0c46_1_3:
	r7 = *r1;
	label$1de0c46_1_4:
	if( r2 ) goto label$1de0c46_1_7;
	r8 = 1.;
	goto label$1de0c46_1_8;
	label$1de0c46_1_7:
	r8 = *r2;
	label$1de0c46_1_8:
	if( r3 ) goto label$1de0c46_1_11;
	r9 = 1.;
	goto label$1de0c46_1_12;
	label$1de0c46_1_11:
	r9 = *r3;
	label$1de0c46_1_12:
	if( r4 ) goto label$1de0c46_1_15;
	r10 = 1.;
	goto label$1de0c46_1_16;
	label$1de0c46_1_15:
	r10 = *r4;
	label$1de0c46_1_16:
	if( r5 ) goto label$1de0c46_1_19;
	r11 = 1.;
	goto label$1de0c46_1_20;
	label$1de0c46_1_19:
	r11 = *r5;
	label$1de0c46_1_20:
	if( r6 ) goto label$1de0c46_1_23;
	r12 = false;
	goto label$1de0c46_1_24;
	label$1de0c46_1_23:
	r12 = *r6;
	label$1de0c46_1_24:
	r14 = r9;
	r2 = &r14;
	r15 = r10;
	r3 = &r15;
	r16 = r11;
	r4 = &r16;
	r5 = NULL;
	h2d_filter_Blur_new(((h2d__filter__Blur)r0),r2,r3,r4,r5);
	r0->color = r7;
	r0->alpha = r8;
	r0->smoothColor = r12;
	r19 = r0->pass;
	if( r19 == NULL ) hl_null_access();
	r18 = r19->shader;
	r20 = (h3d__shader__Blur)r18;
	if( r20 == NULL ) hl_null_access();
	r17 = true;
	r20->constModified = r17;
	r17 = true;
	r20->hasFixedColor__ = r17;
	return;
}

void h2d_filter_Glow_setParams(h2d__filter__Glow r0) {
	h3d__shader__ScreenShader r2;
	bool r11;
	h3d__Vector r1;
	h3d__shader__Blur r4;
	double r7, r10;
	h3d__pass__Blur r3;
	int r6, r8, r9;
	r3 = r0->pass;
	if( r3 == NULL ) hl_null_access();
	r2 = r3->shader;
	r4 = (h3d__shader__Blur)r2;
	if( r4 == NULL ) hl_null_access();
	r1 = r4->fixedColor__;
	r6 = r0->color;
	if( r1 == NULL ) hl_null_access();
	r9 = 16;
	r8 = r6 >> r9;
	r9 = 255;
	r8 = r8 & r9;
	r7 = (double)r8;
	r10 = 255.;
	r7 = r7 / r10;
	r1->x = r7;
	r9 = 8;
	r8 = r6 >> r9;
	r9 = 255;
	r8 = r8 & r9;
	r7 = (double)r8;
	r10 = 255.;
	r7 = r7 / r10;
	r1->y = r7;
	r9 = 255;
	r8 = r6 & r9;
	r7 = (double)r8;
	r10 = 255.;
	r7 = r7 / r10;
	r1->z = r7;
	r9 = 24;
	r8 = ((unsigned)r6) >> r9;
	r7 = (double)r8;
	r10 = 255.;
	r7 = r7 / r10;
	r1->w = r7;
	r3 = r0->pass;
	if( r3 == NULL ) hl_null_access();
	r2 = r3->shader;
	r4 = (h3d__shader__Blur)r2;
	if( r4 == NULL ) hl_null_access();
	r1 = r4->fixedColor__;
	if( r1 == NULL ) hl_null_access();
	r11 = r0->smoothColor;
	if( !r11 ) goto label$1de0c46_2_49;
	r7 = r0->alpha;
	r10 = 1.5;
	r7 = r7 * r10;
	goto label$1de0c46_2_50;
	label$1de0c46_2_49:
	r7 = r0->alpha;
	label$1de0c46_2_50:
	r1->w = r7;
	r3 = r0->pass;
	if( r3 == NULL ) hl_null_access();
	r2 = r3->shader;
	r4 = (h3d__shader__Blur)r2;
	if( r4 == NULL ) hl_null_access();
	r11 = true;
	r4->constModified = r11;
	r11 = r0->smoothColor;
	r4->smoothFixedColor__ = r11;
	return;
}

h2d__Tile h2d_filter_Glow_draw(h2d__filter__Glow r0,h2d__RenderContext r1,h2d__Tile r2) {
	bool *r9;
	String r8;
	h3d__impl__TextureCache r7;
	venum *r5, *r10, *r12, *r15;
	bool r17;
	h3d__mat__Pass r13;
	h3d__pass__Blur r16;
	vdynamic *r14;
	h3d__mat__Texture r4, r6, r11;
	h2d_filter_Glow_setParams(r0);
	if( r2 == NULL ) hl_null_access();
	r4 = r2->innerTex;
	if( r4 == NULL ) hl_null_access();
	r5 = r4->filter;
	if( r1 == NULL ) hl_null_access();
	r7 = r1->textures;
	if( r7 == NULL ) hl_null_access();
	r8 = (String)s$glowSave;
	r9 = NULL;
	r10 = NULL;
	r6 = h3d_impl_TextureCache_allocTileTarget(r7,r8,r2,r9,r10);
	r12 = (venum*)g$h2d_BlendMode_None;
	r13 = NULL;
	r14 = NULL;
	h3d_pass_Copy_run(r4,r6,r12,r13,r14);
	r15 = (venum*)g$h3d_mat_Filter_Linear;
	r15 = h3d_mat_Texture_set_filter(r4,r15);
	r16 = r0->pass;
	if( r16 == NULL ) hl_null_access();
	r11 = NULL;
	h3d_pass_Blur_apply(r16,((h3d__impl__RenderContext)r1),r4,r11);
	r15 = h3d_mat_Texture_set_filter(r4,r5);
	r17 = r0->knockout;
	if( !r17 ) goto label$1de0c46_3_30;
	r12 = (venum*)g$h2d_BlendMode_Erase;
	r13 = NULL;
	r14 = NULL;
	h3d_pass_Copy_run(r6,r4,r12,r13,r14);
	goto label$1de0c46_3_34;
	label$1de0c46_3_30:
	r12 = (venum*)g$h2d_BlendMode_Alpha;
	r13 = NULL;
	r14 = NULL;
	h3d_pass_Copy_run(r6,r4,r12,r13,r14);
	label$1de0c46_3_34:
	return r2;
}

